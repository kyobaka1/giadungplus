{% extends "kho/base_kho.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}
{% block overview %}
<section>
    <h1 class="text-lg font-semibold text-slate-800">In Th∆∞ Xin L·ªói</h1>
    <p class="text-xs text-gray-500 mt-1">√Åp d·ª•ng v·ªõi c√°c ƒë∆°n ƒë·ªïi h√†ng, tr·∫£ h√†ng, thi·∫øu h√†ng... ƒë·ªÉ g·ª≠i k√®m cho kh√°ch h√†ng.</p>
</section>
{% endblock %}
{% block content %}


<head>
    <style>
        @font-face {
            font-family: 'Averta Std CY Bold';
            src: url("{% static 'font/AvetaStdCY/AvertaStdCY-Bold.woff2' %}") format('woff2'),
            url("{% static 'font/AvertaStdCY-Bold.woff' %}") format('woff');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'Averta Std CY Regular';
            src: url("{% static 'font/AvetaStdCY/AvertaStdCY-Regular.woff2' %}") format('woff2'),
            url("{% static 'font/AvertaStdCY-Regular.woff' %}") format('woff');
            font-weight: 500;
            font-style: normal;
        }

        body {
            font-family: 'Averta Std CY Regular', sans-serif;
            font-weight: 500;
            color: black;
            line-height: 1.3 !important;
        }

        p {
            margin-bottom: 4px;
        }

        .bold {
            font-family: 'Averta Std CY Bold', sans-serif;
        }

        .form-container {
            max-width: 400px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-container input,
        .form-container textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .form-container button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .option {
            display: block;
            width: 100%;
            margin-bottom: 8px;
        }

        .option input {
            margin-right: 5px;
        }

        .option .option-label {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #f2f2f2;
            display: inline-block;
            width: 100%;
            cursor: pointer;
        }

        .option input:checked+.option-label {
            background-color: orange;
            color: white;
        }

    </style>
</head>

<div class="w-full bg-slate-100 p-4">
    <div class="w-full max-w-[1600px] mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- C·ªòT 1: FORM NH·∫¨P TH√îNG TIN -->
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 no-print">
                <h2 class="text-lg font-semibold text-slate-800 mb-4">Nh·∫≠p th√¥ng tin</h2>
                <form method="get" action="{% url 'kho:sorry_letter' %}">
                    <!-- T√™n kh√°ch h√†ng -->
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium text-slate-700 mb-1">
                            <span class="text-red-600">*</span> T√™n kh√°ch h√†ng
                        </label>
                        <p class="text-xs text-slate-500 mb-2">Xem tr√™n ƒë∆°n h√†ng! Anh V∆∞∆°ng ho·∫∑c Ch·ªã Trang...</p>
                        <input name="username" id="username" type="text" 
                               class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" 
                               value="{{save.username}}" required placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
                    </div>

                    <!-- Shop -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Shop:</label>
                        <div class="space-y-2">
                            <label class="flex items-center p-2 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition">
                                <input type="radio" name="shop_name" value="Gia D·ª•ng Plus Official" 
                                       {%if save.shop_name == "Gia D·ª•ng Plus Official" %}checked{%endif%}
                                       class="mr-2 text-sky-600 focus:ring-sky-500">
                                <span class="text-sm text-slate-700">Gia D·ª•ng Plus Official</span>
                            </label>
                            <label class="flex items-center p-2 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition">
                                <input type="radio" name="shop_name" value="Phaledo Official" 
                                       {%if save.shop_name == "Phaledo Official" %}checked{%endif%}
                                       class="mr-2 text-sky-600 focus:ring-sky-500">
                                <span class="text-sm text-slate-700">Phaledo Official</span>
                            </label>
                            <label class="flex items-center p-2 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50 transition">
                                <input type="radio" name="shop_name" value="LTENG Official" 
                                       {%if save.shop_name == "LTENG Official" %}checked{%endif%}
                                       class="mr-2 text-sky-600 focus:ring-sky-500">
                                <span class="text-sm text-slate-700">LTENG Official</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- S·∫£n ph·∫©m b·ªã thi·∫øu -->
                    <div class="mb-4">
                        <label for="sanphamthieu" class="block text-sm font-medium text-slate-700 mb-1">
                            <span class="text-red-600">*</span> S·∫£n ph·∫©m b·ªã thi·∫øu
                        </label>
                        <input name="sanphamthieu" id="sanphamthieu" type="text" 
                               class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                               value="{{save.sanphamthieu}}" required placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m b·ªã thi·∫øu">
                    </div>

                    <!-- C√°ch x·ª≠ l√Ω -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">
                            <span class="text-red-600">*</span> C√°ch x·ª≠ l√Ω cho kh√°ch h√†ng
                        </label>
                        <p class="text-xs text-sky-600 mb-2">üí° Click v√†o ph∆∞∆°ng √°n b√™n d∆∞·ªõi ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn!</p>
                        <div class="space-y-2 mb-2">
                            <button type="button" class="solution-option w-full text-left px-3 py-2 text-sm border border-red-300 rounded-lg bg-red-50 text-red-700 hover:bg-red-100 transition">
                                G·ª¨I THI·∫æU v√† HO√ÄN TI·ªÄN
                            </button>
                            <button type="button" class="solution-option w-full text-left px-3 py-2 text-sm border border-red-300 rounded-lg bg-red-50 text-red-700 hover:bg-red-100 transition">
                                G·ª¨I THI·∫æU v√† G·ª¨I B√ô
                            </button>
                            <button type="button" class="solution-option w-full text-left px-3 py-2 text-sm border border-red-300 rounded-lg bg-red-50 text-red-700 hover:bg-red-100 transition">
                                ƒê·ªîI SANG:
                            </button>
                        </div>
                        <input name="phuonganxuly" id="phuonganxuly" type="text" 
                               class="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                               value="{{save.phuonganxuly}}" required placeholder="Nh·∫≠p ph∆∞∆°ng √°n x·ª≠ l√Ω">
                    </div>

                    <!-- N√∫t submit -->
                    <button type="submit" 
                            class="w-full px-4 py-2.5 bg-sky-600 text-white text-sm font-semibold rounded-lg hover:bg-sky-700 transition shadow-sm">
                        üîç XEM TH∆Ø XIN L·ªñI
                    </button>
                </form>
            </div>

            <!-- C·ªòT 2: PREVIEW TH∆Ø XIN L·ªñI -->
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
                <h2 class="text-lg font-semibold text-slate-800 mb-4">Xem tr∆∞·ªõc th∆∞ xin l·ªói</h2>
                <div class="flex justify-center items-start mb-4">
                    <div id="printableArea" style="position: relative; width: 105mm; height: 148mm; border: 1px solid #000; padding: 10px; overflow: hidden; background: white;">
                        <style type="text/css">
                            #printableArea {
                                width: 105mm;
                                height: 148mm;
                                border: 1px solid #000;
                                padding: 10px;
                                position: relative;
                                overflow: hidden;
                                background: white;
                                box-sizing: border-box;
                            }

                            #printableArea p {
                                margin: 0;
                                margin-bottom: 8px;
                            }
                        </style>
                        {% if save.shop_name == "Phaledo Official" %}
                        <div style=" width: 100%;display: flex; height: 60px;">
                            <img src="{% static 'logo-phaledo.jpg' %}" style="height: 60px;margin-bottom: 2px" />
                            <div
                                style="font-size: 16px; width: 70%; text-align: right; height: 60px; font-family: inherit; display: flex">
                                <div style="margin: auto 0 0 auto" class="bold">
                                    PHALEDO OFFICIAL <br>
                                    www.phaledo.vn
                                </div>
                            </div>
                        </div>
                        {% elif save.shop_name == "LTENG Official" %}
                        <div style=" width: 100%;display: flex; height: 60px;">
                            <img src="{% static 'logo-lteng.jpg' %}" style="height: 60px;margin-bottom: 2px" />
                            <div
                                style="font-size: 16px; width: 70%; text-align: right; height: 60px; font-family: inherit; display: flex">
                                <div style="margin: auto 0 0 auto" class="bold">
                                    LTENG OFFICIAL <br>
                                    www.lteng.vn
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div style=" width: 100%;display: flex; height: 60px;">
                            <img src="{% static 'giaodiensang.png' %}" style="height: 60px;margin-bottom: 2px" />
                            <div
                                style="font-size: 16px; width: 70%; text-align: right; height: 60px; font-family: inherit; display: flex">
                                <div style="margin: auto 0 0 auto" class="bold">
                                    GIA D·ª§NG PLUS + <br>
                                    www.giadungplus.com
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <div style="width: 100%;padding-top:4px;  margin-top: 8px ">
                            <p class="bold"
                                style="font-size:32px;line-height: 42px; margin-bottom: 2px; text-align: center;"><b>TH∆Ø
                                    XIN L·ªñI</b></p>
                        </div>
                        <div style="width: 100%; padding:8px">
                            <p style="font-size: 18px; text-align: left;font-weight: bold">K√≠nh g·ª≠i: {{save.username}}
                            </p>
                            <p style="font-size: 18px; text-align: left;">Xin l·ªói ƒë√£ l√†m phi·ªÅn m√¨nh, nh∆∞ng do shop ƒë√£
                                h·∫øt h√†ng s·∫£n ph·∫©m:</p>
                            <p class="bold" style="font-size: 20px; text-align: left;">- {{save.sanphamthieu}}</p>

                            <p style="font-size: 18px; text-align: left;">Shop ƒë√£ c·ªë li√™n h·ªá m√¨nh qua Shopee nh∆∞ng kh√¥ng
                                ƒë∆∞·ª£c. N√™n t·ª•i em ƒë√£ ch·ªß ƒë·ªông x·ª≠ l√Ω t·∫°m th·ªùi:</p>
                            <p class="bold" style="font-size: 20px; text-align: left;">- {{save.phuonganxuly}}</p>

                            <p style="font-size: 17px; text-align: left;">Khi m√¨nh nh·∫≠n ƒë∆∞·ª£c h√†ng, li√™n h·ªá ƒë·ªÉ t·ª•i em x·ª≠ l√Ω cho m√¨nh ngay nha. M·ªôt l·∫ßn n·ªØa, {% if save.shop_name == "Phaledo Official" %}PHALEDO{% elif save.shop_name == "LTENG Official" %}LTENG{% else %}GIA D·ª§NG PLUS{% endif %} ng√†n l·∫ßn xin l·ªói {{save.username}} v√† mong ƒë∆∞·ª£c m√¨nh tha th·ª© ·∫°!</p>
                            <div>
                                <div
                                    style="width: 100%; height: 42px; background: #000; position: absolute;bottom: 0;left: 0; padding-top: 4px">
                                    <p style="font-size: 24px; text-align: center;font-weight: bold; color: white"
                                        class="bold">ZALO: 084.295.1305</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button onclick="printLetter()"
                    class="w-full px-4 py-2.5 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition shadow-sm">
                    üñ®Ô∏è B·∫§M V√ÄO ƒê√ÇY ƒê·ªÇ IN!
                </button>
                <script>
                    function printLetter() {
                        // L·∫•y c√°c gi√° tr·ªã t·ª´ form
                        const username = document.getElementById('username').value;
                        const shopName = document.querySelector('input[name="shop_name"]:checked')?.value || 'Gia D·ª•ng Plus Official';
                        const sanphamthieu = document.getElementById('sanphamthieu').value;
                        const phuonganxuly = document.getElementById('phuonganxuly').value;
                        
                        // T·∫°o URL v·ªõi c√°c tham s·ªë
                        const url = new URL("{% url 'kho:sorry_letter_print' %}", window.location.origin);
                        url.searchParams.set('username', username);
                        url.searchParams.set('shop_name', shopName);
                        url.searchParams.set('sanphamthieu', sanphamthieu);
                        url.searchParams.set('phuonganxuly', phuonganxuly);
                        
                        // M·ªü tab m·ªõi
                        window.open(url.href, '_blank');
                    }
                </script>
            </div>
        </div>
    </div>
</div>

    <script>
        const solutionButtons = document.querySelectorAll('.solution-option');
        const solutionInput = document.getElementById('phuonganxuly');

        solutionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                solutionInput.value = btn.textContent.trim();
            });
        });
    </script>

{% endblock %}