{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="This is an example dashboard created using build-in elements and components.">
    <link rel="icon" href="/static/favicon.png">
    <!-- Disable tap highlight on IE -->
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <meta name="msapplication-tap-highlight" content="no">

    <title>{% block title %}Kho h√†ng ‚Äì Dashboard{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind -->
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>


    <!-- Font Averta -->
    <style>
    @font-face {
        font-family: 'Averta';
        src: url('/static/font/AvetaStdCY/AvertaStdCY-Regular.woff2') format('woff2'),
             url('/static/font/AvetaStdCY/AvertaStdCY-Regular.woff') format('woff');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
    }
    @font-face {
        font-family: 'Averta';
        src: url('/static/font/AvetaStdCY/AvertaStdCY-Bold.woff2') format('woff2'),
             url('/static/font/AvetaStdCY/AvertaStdCY-Bold.woff') format('woff');
        font-weight: 700;
        font-style: normal;
        font-display: swap;
    }

    * {
        font-family: 'Averta', sans-serif;
    }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: "#ee4d2d",
                        brandlight: "#fff1eb"
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-100 text-gray-900 antialiased">

<div class="min-h-screen flex flex-col">

    <!-- ‚ñà‚ñÄ TOP BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <header class="h-14 bg-white border-b shadow-sm flex items-center justify-between px-4">
        <a href="/kho/" class="flex items-center gap-2 hover:opacity-90 transition">
            <div class="w-8 h-8 rounded-md overflow-hidden flex justify-center items-center">
                <img src="/static/favicon.png" alt="Logo" class="w-full h-full object-contain">
            </div>

            <div>
                <div class="text-sm font-semibold">Gia D·ª•ng Plus ‚Äì Kho H√†ng</div>
                <div class="text-[11px] text-gray-500 -mt-1">K√™nh Qu·∫£n Tr·ªã Kho H√†ng</div>
            </div>
        </a>

        <div class="flex items-center gap-4">
    <!-- N√∫t chu√¥ng -->
    <button class="relative p-1.5 rounded-full hover:bg-slate-100">
        üîî
        <span class="absolute -top-1 -right-1 text-[10px] bg-red-500 text-white px-1 rounded-full">3</span>
    </button>

    <!-- Ch·ªçn kho -->
    <div class="relative">
        <!-- Khu v·ª±c hi·ªÉn th·ªã kho + user, d√πng l√†m n√∫t b·∫•m -->
        <button type="button"
                id="khoDropdownButton"
                class="flex items-center gap-2 px-2 py-1.5 rounded-full hover:bg-slate-100 transition">
            <div class="w-8 h-8 rounded-full bg-orange-100 flex justify-center items-center text-xs font-semibold text-brand">
                {% if request.session.current_kho == "toky" %}
                        SG
                    {% else %}
                        HN
                    {% endif %}
            </div>
            <div class="hidden sm:block text-xs leading-tight text-left">
                <!-- Hi·ªÉn th·ªã kho hi·ªán t·∫°i t·ª´ session -->
                <div class="font-medium text-sm">
                    {% if request.session.current_kho == "toky" %}
                        Kho T√¥ K√Ω
                    {% else %}
                        Kho Geleximco
                    {% endif %}
                </div>
                <div class="text-gray-500">{% if request.user.is_authenticated %}
                    {{ request.user.get_full_name  }}
                {% endif %}</div>
            </div>
        </button>

        <!-- Dropdown ch·ªçn kho -->
        <div id="khoDropdownMenu"
             class="absolute right-0 mt-2 w-44 bg-white rounded-xl shadow-lg border border-slate-100 py-1 text-sm hidden z-50">
            <button type="button"
                    data-kho="geleximco"
                    class="w-full text-left px-3 py-2 hover:bg-slate-100 flex items-center justify-between">
                <span>Kho Geleximco</span>
                {% if request.session.current_kho != "toky" %}
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-emerald-100 text-emerald-700">x</span>
                {% endif %}
            </button>
            <button type="button"
                    data-kho="toky"
                    class="w-full text-left px-3 py-2 hover:bg-slate-100 flex items-center justify-between">
                <span>Kho T√¥ K√Ω</span>
                {% if request.session.current_kho == "toky" %}
                    <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-emerald-100 text-emerald-700">x</span>
                {% endif %}
            </button>
        </div>

    </div>
<form method="post" action="{% url 'logout' %}">
    {% csrf_token %}
    <button type="submit"
            class="p-2 rounded-full hover:bg-red-50 text-red-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg"
             fill="none"
             viewBox="0 0 24 24"
             stroke-width="2"
             stroke="currentColor"
             class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
        </svg>
    </button>
</form>


</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('khoDropdownButton');
    const menu = document.getElementById('khoDropdownMenu');

    if (!btn || !menu) return;

    // M·ªü/ƒë√≥ng dropdown khi click v√†o "Kho Geleximco"
    btn.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('hidden');
    });

    // Click ra ngo√†i th√¨ ƒë√≥ng dropdown
    document.addEventListener('click', () => {
        menu.classList.add('hidden');
    });

    // Ch·ªçn kho
    menu.querySelectorAll('[data-kho]').forEach(item => {
        item.addEventListener('click', (e) => {
            const kho = e.currentTarget.getAttribute('data-kho');
            if (!kho) return;
            // ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn endpoint set_kho, view s·∫Ω l∆∞u v√†o session r·ªìi redirect v·ªÅ trang c≈©
            window.location.href = `?kho=${encodeURIComponent(kho)}`;
        });
    });
});
</script>

    </header>

    <!-- ‚ñà‚ñÄ MAIN LAYOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="flex flex-1 overflow-hidden">

        <!-- SIDEBAR (smaller width) -->
        <aside class="w-[160px] bg-white border-r overflow-y-auto">
            <nav class="py-4 text-[13px]">
                <!-- GROUP: ƒê∆°n h√†ng -->
                <div class="px-4 mb-4">
                    <button
                        type="button"
                        class="w-full flex items-center justify-between text-[12px] uppercase text-gray-400 font-semibold mb-2 collapse-toggle"
                        data-collapse-id="menu-orders"
                    >
                        <span>Qu·∫£n l√Ω ƒê∆°n H√†ng</span>
                        <span class="collapse-arrow text-xs text-gray-400 transition-transform duration-200 transform">‚ñæ</span>
                    </button>
                    <ul id="menu-orders" class="space-y-1">
                        <li>
                            <a href="/kho/orders/shopee_orders/" class="flex justify-between px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand sidebar-link ">
                                ƒê∆°n Shopee
                                <span class="text-xs text-gray-500">17</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="flex justify-between px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand sidebar-link ">
                                ƒê∆°n Sapo
                                <span class="text-xs text-gray-500">17</span>
                            </a>
                        </li>
                        <li>
                            <a href="/kho/orders/express/" class="flex justify-between px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand sidebar-link ">
                                Ho·∫£ T·ªëc
                                <span class="text-xs text-gray-500">130</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="flex justify-between px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand sidebar-link ">
                                H√†ng Ho√†n
                                <span class="text-xs text-gray-500">228</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- GROUP: Ticket -->
                <div class="px-4 mb-4">
                    <button
                        type="button"
                        class="w-full flex items-center justify-between text-[12px] uppercase text-gray-400 font-semibold mb-2 collapse-toggle"
                        data-collapse-id="menu-ticket"
                    >
                        <span>Ticket</span>
                        <span class="collapse-arrow text-xs text-gray-400 transition-transform duration-200 transform">‚ñæ</span>
                    </button>
                    <ul id="menu-ticket" class="space-y-1">
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">Ticket</a>
                        </li>
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">X√°c nh·∫≠n l·ªói</a>
                        </li>
                    </ul>
                </div>

                <!-- GROUP: Qu·∫£n tr·ªã -->
                <div class="px-4 mb-4">
                    <button
                        type="button"
                        class="w-full flex items-center justify-between text-[12px] uppercase text-gray-400 font-semibold mb-2 collapse-toggle"
                        data-collapse-id="menu-admin"
                    >
                        <span>Qu·∫£n Tr·ªã</span>
                        <span class="collapse-arrow text-xs text-gray-400 transition-transform duration-200 transform">‚ñæ</span>
                    </button>
                    <ul id="menu-admin" class="space-y-1">
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">SOS Shopee</a>
                        </li>
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">ƒê√£ g√≥i, b·ªã hu·ª∑</a>
                        </li>
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">Th·ªëng k√™</a>
                        </li>
                    </ul>
                </div>

                <!-- GROUP: H·ªó tr·ª£ in -->
                <div class="px-4 mb-4">
                    <button
                        type="button"
                        class="w-full flex items-center justify-between text-[12px] uppercase text-gray-400 font-semibold mb-2 collapse-toggle"
                        data-collapse-id="menu-print"
                    >
                        <span>H·ªó tr·ª£ in</span>
                        <span class="collapse-arrow text-xs text-gray-400 transition-transform duration-200 transform">‚ñæ</span>
                    </button>
                    <ul id="menu-print" class="space-y-1">
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">Th∆∞ ƒë·ªïi tr·∫£</a>
                        </li>
                        <li>
                            <a href="#" class="block px-2 py-1 rounded-md hover:bg-brandlight hover:text-brand">S·∫£n ph·∫©m</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- ‚ñà‚ñÄ MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto">
            <div class="px-5 py-4 space-y-6">

                <!-- ‚ñà‚ñÄ OVERVIEW BLOCK -->
                {% block overview %}
                <section>
                    <h1 class="text-lg font-semibold text-slate-800">
                        T·ªïng quan kho h√†ng
                    </h1>
                    <p class="text-xs text-gray-500 mt-1">
                        H√¥m nay (GMT+7). D·ªØ li·ªáu realtime theo Shopee.
                    </p>
                </section>
                {% endblock %}

                <!-- ‚ñà‚ñÄ CONTENT BLOCK -->
                {% block content %}
                <section>
                    <div class="p-6 bg-white border rounded-xl shadow-sm text-sm text-gray-500">
                        ƒê√¢y l√† n·ªôi dung c·ªßa trang con.
                        S·ª≠ d·ª•ng:
                        <pre class="text-[11px] bg-slate-100 p-3 rounded-md mt-2">
{% verbatim %}{% extends "base_kho.html" %}
{% block overview %}...{% endblock %}
{% block content %}...{% endblock %}{% endverbatim %}
                        </pre>
                    </div>
                </section>
                {% endblock %}

            </div>
        </main>
    </div>
</div>

<!-- JS toggle sidebar group -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const toggles = document.querySelectorAll('.collapse-toggle');

    toggles.forEach(function (btn) {
        const id = btn.getAttribute('data-collapse-id');
        const body = document.getElementById(id);
        const arrow = btn.querySelector('.collapse-arrow');

        if (!body) return;

        btn.addEventListener('click', function () {
            const isHidden = body.classList.toggle('hidden');
            if (arrow) {
                // khi thu g·ªçn: m≈©i t√™n quay ngang (-90deg)
                if (isHidden) {
                    arrow.classList.add('-rotate-90');
                } else {
                    arrow.classList.remove('-rotate-90');
                }
            }
        });
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const currentURL = window.location.pathname;
    const links = document.querySelectorAll('.sidebar-link');

    links.forEach(link => {
        // So s√°nh URL (/express_orders)
        if (link.getAttribute('href') === currentURL) {

            // T√¥ active
            link.classList.add(
                "bg-brandlight",
                "text-brand",
                "font-semibold"
            );

            // T√¨m nh√≥m cha v√† auto m·ªü n√≥
            let parent = link.closest("ul");
            if (parent) {
                parent.classList.remove('hidden');   // m·ªü dropdown

                // Xoay m≈©i t√™n
                const button = parent.previousElementSibling;
                if (button && button.querySelector('.collapse-arrow')) {
                    button.querySelector('.collapse-arrow').classList.remove('-rotate-90');
                }
            }
        }
    });
});
</script>

</body>
</html>
