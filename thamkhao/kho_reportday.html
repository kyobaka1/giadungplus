{% load humanize %}


<html lang="vi-VN">
<head>
    <meta name="description" content="This is an example dashboard created using build-in elements and components.">
    <link rel="icon" href="/static/favicon.png">
    <!-- Disable tap highlight on IE -->
    <link rel="shortcut icon" href="/static/favicon.png"/>
    
    <meta name="msapplication-tap-highlight" content="no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style type="text/css">
      /* load regular */
    @font-face {
      font-family: "AvertaStdCY";
      src: url("/static/font/AvertaStdCY-Regular.woff2") format("woff2"),
           url("/static/font/AvertaStdCY-Regular.woff") format("woff");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    /* load bold */
    @font-face {
      font-family: "AvertaStdCY";
      src: url("/static/font/AvertaStdCY-Bold.woff2") format("woff2"),
           url("/static/font/AvertaStdCY-Bold.woff") format("woff");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }
    </style>
</head>

<style>/* combined & minified, px‚Üírem */
:root{--bg-dark:#121418;--bg-panel:#1a1d23;--text-primary:#ffffff;--text-secondary:#9ba4b4;--accent-blue:#00b8ff;--accent-purple:#a359ff;--accent-green:#00ff9d;--accent-red:#ff5370;--transition-speed:.3s;--border-radius:.75rem;}
*{box-sizing:border-box;}
html{font-size:100%;}body{font-family:"AvertaStdCY",system-ui,-apple-system,BlinkMacSystemFont,sans-serif!important;}
@media (max-width:64rem){html{font-size:15px;}}@media (max-width:48rem){html{font-size:14px;}}
.fluid-text{font-size:clamp(.75rem,1.2vw,1rem);}
.container{width:100%;max-width:75rem;background-color:var(--bg-panel);border-radius:var(--border-radius);box-shadow:0 .9375rem 2.1875rem rgba(0,0,0,.3);display:flex;flex-direction:column;padding:1.5rem;position:relative;overflow:hidden;}
.group-switch{position:relative;display:inline-flex;background:#1f2235;border:1px solid rgba(127,90,240,.3);border-radius:9999px;padding:.25rem;}
.group-switch-bg{position:absolute;top:.25rem;bottom:.25rem;width:7.5rem;background:rgba(127,90,240,.1);border-radius:9999px;transition:transform .3s ease;z-index:1;}
.switch-button{position:relative;z-index:2;width:7.5rem;text-align:center;padding:.5rem 0;font-weight:500;cursor:pointer;color:#cbd5e1;transition:color .3s ease;}
.switch-button.active{color:#fff;font-weight:600;}
.header{font-size:1.75rem;font-weight:700;background:linear-gradient(to right,var(--accent-blue),var(--accent-purple));-webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:-.03125rem;}
input[type=date]{background:#1e293b;color:#fff;border-color:#475569;}
label{color:#e2e8f0;}
.data-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(13.75rem,1fr));gap:1rem;}
.data-card{background:#1f2235;color:#e5e7eb;border-radius:1rem;padding:1rem 1.25rem;position:relative;overflow:hidden;min-height:7.5rem;display:flex;flex-direction:column;justify-content:space-between;transition:transform .2s ease,filter .2s ease,box-shadow .3s ease;border:1px solid rgba(127,90,240,.2);box-shadow:0 1.5625rem 3.125rem -0.625rem rgba(127,90,240,.3);}
.data-card:hover{transform:translateY(-.1875rem);filter:brightness(1.05);box-shadow:0 1.5625rem 3.125rem -0.625rem rgba(127,90,240,.4);}
.data-card-title{font-size:.9rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:.25rem;color:#9ca3af;position:relative;}
.data-card-title:after{content:"";display:block;width:2.5rem;height:.1875rem;margin-top:.375rem;border-radius:.1875rem;background:linear-gradient(135deg,#7f5af0,#f767a1);box-shadow:0 .5rem 1.25rem - .3125rem rgba(127,90,240,.6);}
.data-card-value{font-size:1.75rem;font-weight:700;margin:.25rem 0;}
.data-card-change{display:inline-flex;align-items:center;gap:.25rem;font-size:.40625rem;font-weight:600;padding:.25rem .625rem;border-radius:999px;backdrop-filter:blur(.375rem);background:rgba(255,255,255,.03);position:absolute;top:.5rem;right:.5rem;}
.data-card-change.positive{color:var(--accent-green);background:rgba(0,255,157,.08);}
.data-card-change.negative{color:var(--accent-red);background:rgba(255,83,112,.08);}
.control-group.order-processing.light{color:#fff;border-radius:.25rem;padding:.1875rem .25rem;display:flex;flex-direction:column;gap:.375rem;position:relative;}
.control-group.order-processing.light .group-header{display:flex;align-items:center;gap:.5rem;}
.control-group.order-processing.light .group-icon{background:#1a1f3a;padding:.5rem;border-radius:999px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(127,90,240,.3);box-shadow:0 .9375rem 2.1875rem -.3125rem rgba(127,90,240,.2);flex-shrink:0;}
.control-group.order-processing.light svg{stroke:#aeb8d9;}
.control-group.order-processing.light .group-title{margin:0;font-size:1.75rem;font-weight:700;line-height:1.2;color:#fff;}
.control-group.order-processing.light .group-subtitle{font-size:.9rem;color:#94a3b8;}
#annotation,#annotation-packed{background:linear-gradient(135deg,#1f2240,#2a2e55);color:#f0f9ff;border:1px solid rgba(127,90,240,.6);border-radius:.75rem;padding:.75rem .875rem;position:absolute;box-shadow:0 1.25rem 3.125rem - .625rem rgba(127,90,240,.35);min-width:10.625rem;line-height:1.2;z-index:10;}
#annotation .font-semibold,#annotation-packed .font-semibold{font-size:.875rem;margin-bottom:.375rem;font-weight:700;}
#annotation .font-medium,#annotation-packed .font-medium{font-weight:600;}
#annotation:after,#annotation-packed:after{content:"";position:absolute;width:.75rem;height:.75rem;background:transparent;border:2px solid rgba(255,255,255,.5);border-right:none;border-top:none;transform:rotate(45deg);top:50%;left:-.375rem;translate:0 -50%;box-shadow:0 0 .75rem rgba(127,90,240,.5);}
#annotation-packed:after{left:auto;right:-.375rem;border-left:none;border-bottom:none;transform:rotate(225deg);}
.annotation-currency{font-size:.5625rem;color:#d0e8ff;margin-top:.125rem;}
#stats-container{display:flex;gap:1rem;align-items:stretch;flex-wrap:wrap;flex-direction:column;margin-left:1.5625rem;}
.stat-card{background:#1f2235;color:#e5e7eb;border-radius:1rem;padding:.4rem 0.5rem;min-width:1.2rem;display:flex;flex-direction:column;justify-content:space-between;position:relative;box-shadow:0 1.5625rem 3.125rem - .625rem rgba(127,90,240,.3);border:1px solid rgba(127,90,240,.2);transition:transform .2s ease;}
.stat-card:hover{transform:translateY(-.1rem);}
.card{background:linear-gradient(135deg,rgba(16,20,30,.8),rgba(8,11,18,.95))!important;border-radius:1.5625rem;box-shadow:0 1.25rem 3.125rem rgba(0,0,0,.5);backdrop-filter:blur(.625rem);border:1px solid rgba(255,255,255,.05);}
.stat-label{font-size:.8rem;text-transform:uppercase;letter-spacing:1px;color:#9ca3af;margin-bottom:.25rem;}
.stat-value{font-size:1.1rem;font-weight:600;display:flex;flex-direction:column;gap:.125rem;}
.value-main{font-size:2rem;font-weight:700;background:linear-gradient(90deg,#7f5af0,#f767a1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.sub{font-size:.8rem;color:#a0b0d0;}
.legend-item{display:flex;align-items:flex-start;gap:.625rem;padding:.375rem .5rem;border-radius:.5rem;background:rgba(255,255,255,.02);position:relative;}
.legend-color-box{width:.75rem;height:.75rem;border-radius:.1875rem;flex-shrink:0;margin-top:.1875rem;}
.legend-info{flex:1;display:flex;flex-direction:column;gap:.125rem;}
.legend-title{font-weight:600;font-size:.875rem;display:flex;justify-content:space-between;gap:.375rem;}
.legend-metrics{font-size:.75rem;color:#c0c8e0;display:flex;flex-wrap:wrap;gap:.5rem;}
.top-badge{background:linear-gradient(135deg,#00b8ff,#a359ff);padding:.25rem .5rem;border-radius:999px;font-size:.625rem;color:#fff;margin-left:.375rem;}
.callout{position:relative;padding:.375rem .75rem;background:#1f2430;border-radius:.5rem;color:#fff;font-size:.75rem;display:flex;align-items:center;gap:.5rem;overflow:hidden;}
.color-dot{width:.625rem;height:.625rem;border-radius:50%;flex-shrink:0;margin-right:.375rem;}
.callout-line{position:absolute;pointer-events:none;stroke:#888;stroke-width:1.5;fill:none;}
.label-text{display:flex;flex-direction:column;gap:.125rem;flex:1;}
.small{font-size:.6875rem;color:#c0c8e0;}
.pct{font-weight:600;}
.shared-table{width:100%;border-collapse:collapse;font-size:0.75rem;color:#e5e9ff;border-radius:.3125rem;}
.shared-table th,.shared-table td{padding:.375rem .5rem;text-align:left;white-space:nowrap;vertical-align:middle;}
.shared-table thead th{position:sticky;top:0;background:rgba(255,255,255,.03);font-weight:600;border-bottom:1px solid rgba(255,255,255,.15);padding:.5rem .3125rem;}
.row-separator{background:rgba(255,255,255,.06);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.sender-row{border-bottom:1px solid rgba(255,255,255,.08);transition:background .15s;}
.sender-row:hover{background:rgba(255,255,255,.02);}
.badge-role{background:rgba(255,255,255,.08);padding:.1875rem .625rem;border-radius:999px;font-size:.6875rem;display:inline-block;}
.numeric{text-align:right;font-feature-settings:"tnum" on;}
.warehouse-gele{background:rgba(63,143,255,.08);}
.warehouse-toky{background:rgba(63,255,157,.08);}
.carrier-grid{display:flex;flex-wrap:wrap;gap:.5rem;width:100%;}
.carrier-card{background:linear-gradient(135deg,#1f2338 0%,#1a1f33 70%);border:1px solid rgba(255,255,255,.06);border-radius:.5rem;padding:.375rem .5rem;min-width:10rem;flex:1 1 10rem;position:relative;overflow:hidden;color:#f0f5ff;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;box-shadow:0 .9375rem 1.875rem -.3125rem rgba(0,0,0,.5);transition:transform .2s,box-shadow .2s;}
.carrier-card:hover{transform:translateY(-.125rem);box-shadow:0 .9375rem 2.5rem -.625rem rgba(0,0,0,.6);}
.carrier-name{font-size:.875rem;font-weight:700;display:flex;align-items:center;gap:.375rem;margin-bottom:.375rem;}
.percent-badge{background:linear-gradient(90deg,#FF6B6B,#FFE66D);padding:.125rem .5rem;border-radius:999px;font-size:.75rem;font-weight:600;color:#000;margin-left:auto;white-space:nowrap;}
.stats{display:flex;flex-direction:column;gap:.375rem;font-size:.75rem;margin-top:.25rem;}
.stat-line{display:flex;justify-content:space-between;align-items:center;gap:.125rem;}
.stat-label{color:var(--text-secondary);}
.stat-value{font-weight:600;text-align:right;}
.small-tag{background:rgba(255,255,255,.08);padding:.1875rem .625rem;border-radius:999px;font-size:.625rem;display:inline-block;margin-top:.25rem;}
.fast-delivery-wrapper{display:flex;gap:.5rem;flex-wrap:wrap;width: 100%; margin-bottom: 20px;}
.fast-card{flex:1 1 11.25rem;background:linear-gradient(135deg,#1f253f 0%,#141a2b 80%);border:1px solid rgba(255,255,255,.08);border-radius:.5rem;padding:.3125rem .5rem;position:relative;color:#eef2ff;box-shadow:0 1.5625rem 2.8125rem - .625rem rgba(16,25,80,.6);width:11.25rem;display:flex;flex-direction:column;gap:.3125rem;transition:transform .2s,box-shadow .2s;}
.fast-card:hover{transform:translateY(-.125rem);box-shadow:0 1.5625rem 3.4375rem - .3125rem rgba(16,25,80,.8);}
.fast-header{font-size:.8125rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;display:inline-block;padding:.375rem .75rem;background:rgba(255,255,255,.04);border-radius:999px;margin-bottom:.375rem;width:fit-content;}
.fast-body{display:flex;gap:.875rem;align-items:center;}
.percent-block{flex:0 0 5rem;display:flex;flex-direction:column;align-items:flex-start;gap:.25rem;}
.big-pct{font-size:1.625rem;font-weight:700;line-height:1;background:linear-gradient(90deg,#FF6B6B,#FFE66D);-webkit-background-clip:text;-webkit-text-fill-color:transparent;position:relative;}
.sub-label{font-size:.625rem;font-weight:600;text-transform:uppercase;color:#9ba4b4;letter-spacing:1px;}
.details{flex:1;display:flex;flex-direction:column;gap:.375rem;font-size:.75rem;}
.line{display:flex;justify-content:space-between;align-items:center;gap:.25rem;}
.line .label{color:#9ba4b4;font-weight:500;}
.line .value{font-weight:600;min-width:2.5rem;text-align:right;}
.line .small{font-size:.6875rem;opacity:.9;}
.trend-badges{display:flex;gap:.25rem;flex-wrap:wrap;align-items:center;}
.trend-pill{border-radius:999px;font-size:.6875rem;display:flex;align-items:center;gap:.1875rem;background:rgba(255,255,255,.04);color:#e5e9ff;position:relative;padding:.25rem .5rem;}
.trend-pill.top1{border:1px solid;border-radius:3px;background:rgba(255,255,255,.02);}
.trend-pill .cat-name{white-space:nowrap;}
.trend-pill .pct{background:rgba(255,255,255,.08);border-radius:999px;font-size:.625rem;padding:.1875rem .25rem;margin-left:.125rem;}
/* responsive header fix */
.flex.items-center.justify-between{display:flex;flex-wrap:wrap;gap:.5rem;}
.header{display:flex;align-items:center;gap:.75rem;flex:1 1 auto;min-width:0;}
.header img{width:3.5rem;height:3.5rem;flex-shrink:0;}
.header span{font-size:3rem;font-weight:700;line-height:1.1;display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
@media (max-width:768px){.flex.items-center.justify-between{flex-direction:column;align-items:flex-start;} .group-switch{margin-top:.5rem;} .header img{width:2.75rem;height:2.75rem;} .header span{font-size:2.25rem;}}
.group-switch{flex-shrink:0;display:inline-flex;position:relative;}


</style>


<body>
<div class="bg-gray-900 text-white flex justify-center items-center min-h-screen">

  <div class="container space-y-4">
    <!-- Feedback form (·∫©n m·∫∑c ƒë·ªãnh) -->
    <div id="feedback-panel" style="display:none; margin-top:12px; background: rgba(31,34,53,1); border:1px solid rgba(127,90,240,0.4); border-radius:12px; padding:16px; position:relative; max-width:800px;">
      <div style="display:flex;justify-content:space-between;align-items:center; gap:12px; flex-wrap:wrap;">
        <div style="display:flex;gap:12px; flex:1; min-width:250px;">
          <div style="display:flex;flex-direction:column;gap:4px; flex:1;">
            <label style="font-size:.65rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted);">Ch·ªçn kho h√†ng</label>
            <select id="feedback-location" style="padding:8px 10px; border-radius:8px; background: #1f2235; border:1px solid rgba(127,90,240,0.3); color:#fff; font-size:.9rem; appearance:none; cursor:pointer;">
              <option value="gele">H√Ä N·ªòI</option>
              <option value="toky">S√ÄI G√íN</option>
            </select>
          </div>
          <div style="display:flex;flex-direction:column;gap:4px; flex:1; min-width:200px;">
            <label style="font-size:.65rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted);">Ch·ªçn tags</label>
            <div style="display:flex;gap:6px; flex-wrap:wrap;" id="feedback-tags">
              <!-- dynamic tag pills -->
              <div class="trend-pill" data-tag="T·ª∞ ƒê√ÅNH GI√Å" style="cursor:pointer;">T·ª∞ ƒê√ÅNH GI√Å</div>
              <div class="trend-pill" data-tag="G√ìP √ù" style="cursor:pointer;">G√ìP √ù</div>
              <div class="trend-pill" data-tag="ƒê·ªÄ XU·∫§T" style="cursor:pointer;">ƒê·ªÄ XU·∫§T</div>
              <div class="trend-pill" data-tag="PH√ÅT SINH" style="cursor:pointer;">PH√ÅT SINH</div>
              <div class="trend-pill" data-tag="KH√ÅC" style="cursor:pointer;">KH√ÅC</div>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:12px; align-items:center; flex-shrink:0;">
          <button id="feedback-submit" style="background:linear-gradient(135deg,var(--grad1),var(--grad2)); color:#fff; border:none; padding:.55rem 1rem; border-radius:.75rem; font-weight:600; cursor:pointer; min-width:120px;">G·ª≠i</button>
          <button id="feedback-cancel" style="background:rgba(255,255,255,0.08); color:#fff; border:none; padding:.55rem 1rem; border-radius:.75rem; cursor:pointer;">Hu·ª∑</button>
        </div>
      </div>
      <div style="margin-top:12px; display:flex; flex-direction:column; gap:6px;">
        <label style="font-size:.65rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted);">N·ªôi dung</label>
        <textarea id="feedback-content" rows="4" placeholder="Vi·∫øt ph·∫£n h·ªìi..." style="width:100%;background:rgba(255,255,255,0.03);border:1px solid rgba(127,90,240,0.3);border-radius:8px;padding:12px;color:#eef2ff;resize:vertical;font-size:.9rem;outline:none;"></textarea>
      </div>
      <div id="feedback-msg" style="margin-top:8px;font-size:.8rem;"></div>
    </div>
    <!-- Header -->
    <div class="flex items-center justify-between">
      <h1 class="header flex items-center gap-3">
        <div style="display:flex;flex-direction:column;line-height:1;">
          <span>B√°o c√°o ho·∫°t ƒë·ªông kho</span>
          <span style="font-size:.85rem;color:var(--accent-purple);margin-top:2px;">C√îNG TY CP TMDV GIA D·ª§NG PLUS</span>
        </div>
      </h1>


      <!-- Group Tab Switch -->
      <div class="group-switch" id="regionSwitch">
        <div class="group-switch-bg" id="switchBg"></div>
        <div class="switch-button active" onclick="switchRegion(0)">ALL</div>
        <div class="switch-button" onclick="switchRegion(1)">H√Ä N·ªòI</div>
        <div class="switch-button" onclick="switchRegion(2)">S√ÄI G√íN</div>
      </div>
    </div>

    <!-- Ng√†y ch·ªçn -->
    <div class="flex flex-wrap items-center gap-2 bg-gray-800 p-2 rounded-xl shadow-md">
      <label for="start_date">T·ª´ ng√†y:</label>
      <input type="date" id="start_date" class="border rounded-lg p-2" />
      <label for="end_date">ƒê·∫øn ng√†y:</label>
      <input type="date" id="end_date" class="border rounded-lg p-2" />
      <button onclick="xemBaoCao()"
  class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition shadow-md hover:shadow-lg">
  Xem b√°o c√°o
</button>
<button
  id="add-feedback-btn" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition shadow-md hover:shadow-lg">
  Th√™m ph·∫£n h·ªìi
</button>
    </div>


    <!-- K·∫øt qu·∫£ -->
    <div id="report-content" class="bg-gray-800 p-2 rounded-xl shadow-md mt-2">
      <p class="text-slate-300">üìã Vui l√≤ng ch·ªçn th·ªùi gian v√† khu v·ª±c ƒë·ªÉ xem b√°o c√°o.</p>
    </div>
    <div id="report-ui" class="space-y-4 mt-2"></div>
    <div id="note-report" style="margin-top:16px; display:flex; gap:12px; flex-wrap:wrap;"></div>

    <div id="shopee-report" class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-[var(--bg-dark)]"></div>

  </div>

<script>
// globals m·∫∑c ƒë·ªãnh
  window.regionIDs = window.regionIDs || ["241737,548744", "241737", "548744"];
  window.regionNames = window.regionNames || ["ALL", "H√Ä N·ªòI", "S√ÄI G√íN"];
  window.currentRegionIndex = typeof window.currentRegionIndex !== "undefined" ? window.currentRegionIndex : 0;

  // c·∫≠p nh·∫≠t visual v√† state khi ƒë·ªïi region
  function switchRegion(index) {
    window.currentRegionIndex = index;
    const buttons = document.querySelectorAll(".switch-button");
    const switchBg = document.getElementById("switchBg");
    // d·ªãch n·ªÅn theo index (chi·ªÅu r·ªông m·ªói button 120px nh∆∞ CSS c≈©)
    if (switchBg) {
      switchBg.style.transform = `translateX(${index * 120}px)`;
    }
    buttons.forEach((btn, i) => {
      btn.classList.toggle("active", i === index);
    });
  }

  // kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
  document.addEventListener("DOMContentLoaded", () => {
    switchRegion(window.currentRegionIndex);
    // auto set dates n·∫øu c·∫ßn (n·∫øu c√≤n c√°i c≈© th√¨ gi·ªØ)
    const today = new Date().toISOString().split("T")[0];
    if (!document.getElementById("start_date").value) document.getElementById("start_date").value = today;
    if (!document.getElementById("end_date").value) document.getElementById("end_date").value = today;
  });

  // helper format
  function formatVND(x) {
    if (x == null) return "0";
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }
  function formatNumberWithCommas(x) {
  if (x == null || isNaN(x)) return "0";
  return new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(x);
}

  // render UI t·ª´ data
  function renderReportInline(data, start, end, regionName) {
    const container = document.getElementById("report-ui");
    const sum = data.summary.sum;
    const gele = data.summary.gele;
    const toky = data.summary.toky;
    const efficiency_sum = data.efficiency.sum;
    const pie_data = data.pie_data;
    const pie_cato = data.pie_cato;
    const hourly  = data.hourly;
    const categories_summary = data.summary.categories;
    const by_sender = data.by_sender;
    const carrier_summary  = data.carrier_summary ;
    const fast_delivery = data.fast_delivery ;
    const inventory_summary = data.inventory_summary ;
    const deadline_summary= data.deadline_summary ;



    const COLOR_PALETTE = [
        "#a359ff",
        "#00b8ff",
        "#00ff9d",
        "#ff5370",
        "#ffd54f",
        "#5af1ff",
        "#ff7eb9",
        "#7c4dff",
        "#21c7a8",
        "#ff9f43"
      ];

      const STATUS_CONFIG = [
    {
      key: 'not_shipped_late',
      title: 'Ch∆∞a giao, tr·ªÖ',
      icon: '‚ö†Ô∏è',
      colorClass: 'from-[#ffb86c]' // gradient ngu·ªìn
    },
    {
      key: 'shipped_late',
      title: 'ƒê√£ giao, tr·ªÖ',
      icon: '‚è∞',
      colorClass: 'from-[#ff5370]'
    },
    {
      key: 'shipped_on_time',
      title: 'Giao ƒë√∫ng h·∫°n',
      icon: '‚úÖ',
      colorClass: 'from-[#00b8ff]'
    }
  ];

    container.innerHTML = `
      <div class="data-grid">
        <div class="data-card">
          <div class="data-card-title">T·ªïng ƒë∆°n h√†ng ƒë√£ g√≥i</div>
          <div class="data-card-value gradient">${sum.sodonhang} <span class="tiny">ƒë∆°n</span> </div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">S·∫£n ph·∫©m:</span>
            <span class="font-semibold">${sum.sosanpham} (${sum.pcs_per_orders} / ƒë∆°n)</span>
          </div>
        </div>
        <div class="data-card">
          <div class="data-card-title">Doanh s·ªë</div>
          <div class="data-card-value gradient">${formatVND(sum.doanhso)} ‚Ç´</div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">GELE: ${gele.tile_sodonhang}% - TOKY: ${toky.tile_sodonhang}%</span>
          </div>
        </div>
       
        <div class="data-card">
          <div class="data-card-title">Hi·ªáu su·∫•t l√†m vi·ªác</div>
          <div class="data-card-value gradient">${formatVND(sum.hieusuat.doanhso_per_hour)} <span> ƒë/h</span></div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">T·ªïng ${sum.hieusuat.total_work_hours} gi·ªù:</span>
            <span class="font-semibold"> <span> ${sum.hieusuat.order_per_hour} ƒë∆°n/h</span></span>
          </div>
        </div>
        <div class="data-card">
          <div class="data-card-title">T·ªïng ticket:</div>
          <div class="data-card-value gradient">6</span></div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">Ch∆∞a x·ª≠ l√Ω:</span>
            <span class="font-semibold">2</span>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-4 gap-2 mt-2">
        <div class="card p-2 col-span-2">
          <div class="control-group order-processing light">
            <div class="group-header">
              <div class="group-icon">
                <!-- icon x·ª≠ l√Ω ƒë∆°n: h·ªôp + b√°nh rƒÉng -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 7h18v4H3V7z" /> <!-- h·ªôp ƒë·∫ßu -->
                  <path d="M3 11h18v6H3v-6z" /> <!-- th√¢n h·ªôp -->
                  <path d="M8 11v-4" />
                  <path d="M16 11v-4" />
                  <circle cx="12" cy="14" r="2" /> <!-- b√°nh rƒÉng trung t√¢m bi·ªÉu t∆∞·ª£ng x·ª≠ l√Ω -->
                  <path d="M12 11v1" />
                  <path d="M12 17v1" />
                  <path d="M9.5 14h-1" />
                  <path d="M16.5 14h-1" />
                </svg>
              </div>
              <div class="group-title-wrap">
                <h2 class="group-title">X·ª≠ l√Ω ƒë∆°n</h2>
                <div class="group-subtitle">T·ªïng quan v·ªÅ x·ª≠ l√Ω ƒë∆°n h√†ng</div>
              </div>
            </div>
        </div>

          <div class="flex gap-4 justify-center mt-2">
            <!-- Pie + Annotations container -->
            <div class="relative w-72 m-auto">
              <div class="relative" style="width: 200px; height: 200px;">
                  <canvas id="packingPie" width="200" height="200" style="width:200px; height:200px; display:block;"></canvas>
                  <!-- annotations... -->
                </div>

              <!-- Ch∆∞a g√≥i -->
              <div id="annotation" class="absolute top-0 left-[45%] transform -translate-y-1/2 rounded-xl shadow-lg p-3 text-sm w-22">
                <div class="font-semibold mb-1">ƒê∆°n ch∆∞a g√≥i</div>
                <div><span class="font-medium">${pie_data.unpacked}</span> ƒë∆°n  (${pie_data.unpacked_pct}%)</div>
                <div><span class="font-medium">${formatVND(pie_data.unpacked_revenue)}‚Ç´</span></div>
              </div>

              <!-- ƒê√£ g√≥i -->
              <div id="annotation-packed" class="absolute bottom-[-15%] left-[-20%] transform -translate-y-1/2 rounded-xl shadow-lg p-3 text-sm w-22">
                <div class="font-semibold mb-1">ƒê∆°n ƒë√£ g√≥i</div>
                <div><span class="font-medium">${pie_data.packed}</span> ƒë∆°n (${pie_data.packed_pct}%)</div>
                <div><span class="font-medium">${formatVND(pie_data.packed_revenue)}‚Ç´</span></div>
              </div>
            </div>

             <!-- Stats for pending categories -->
              <div class="stats-container visible" id="stats-container">
                <div class="stat-card">
                  <div class="stat-label">Giao tr∆∞·ªõc 12H</div>
                  <div class="stat-value">
                    <div><span class="value-main">${data.summary.pending_deadlines.before_today.sodonhang}</span> ƒë∆°n</div>
                    <div class="sub"> ${formatVND(data.summary.pending_deadlines.before_today.doanhso)}‚Ç´</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Giao tr∆∞·ªõc 24H</div>
                  <div class="stat-value">
                    <div><span class="value-main">${data.summary.pending_deadlines.before_18.sodonhang}</span> ƒë∆°n</div>
                    <div class="sub"> ${formatVND(data.summary.pending_deadlines.before_18.doanhso)}‚Ç´</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Tr∆∞a mai</div>
                  <div class="stat-value">
                    <div><span class="value-main">${data.summary.pending_deadlines.after_18.sodonhang}</span> ƒë∆°n</div>
                    <div class="sub"> ${formatVND(data.summary.pending_deadlines.after_18.doanhso)}‚Ç´</div>
                  </div>
                </div>
             </div>
          </div>
        </div>

        <div class="card p-2 col-span-2">
          <div class="control-group order-processing light">
            <div class="group-header">
              <div class="group-icon">
                <!-- icon x·ª≠ l√Ω ƒë∆°n: h·ªôp + b√°nh rƒÉng -->
                <svg width="20" height="20" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor">
                <!-- h·ªôp g√≥i -->
                <g stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">
                  <path d="M10 20h44v8H10V20z" />
                  <path d="M10 28h44v14H10V28z" />
                  <path d="M20 28v-8" />
                  <path d="M44 28v-8" />
                </g>
                <!-- ƒë∆∞·ªùng trend d∆∞·ªõi h·ªôp -->
                <polyline points="12,50 20,42 28,46 36,38 44,44 52,36" fill="none" stroke="#00b8ff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="20" cy="42" r="3" fill="#a359ff" stroke="none"/>
                <circle cx="28" cy="46" r="3" fill="#00ff9d" stroke="none"/>
                <circle cx="36" cy="38" r="3" fill="#ff5370" stroke="none"/>
                <circle cx="44" cy="44" r="3" fill="#ffd54f" stroke="none"/>
                <!-- ƒë·ªìng h·ªì nh·ªè b√™n ph·∫£i tr√™n -->
                <g transform="translate(44,12)">
                  <circle cx="0" cy="0" r="8" stroke-width="2" />
                  <line x1="0" y1="0" x2="0" y2="-4" stroke-width="2" stroke-linecap="round"/>
                  <line x1="0" y1="0" x2="3" y2="0" stroke-width="2" stroke-linecap="round"/>
                </g>
              </svg>

              </div>
              <div class="group-title-wrap">
                <h2 class="group-title">Hi·ªáu su·∫•t trong ng√†y</h2>
                <div class="group-subtitle">Ph√¢n b·ªï theo m·ªëc th·ªùi gian g√≥i h√†ng</div>
              </div>
            </div>
        </div>

          <div class="flex gap-4 justify-center mt-2">
            <div class="mt-6">
              <canvas id="hourlyChart" width="600" height="320"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-5 gap-2 mt-4">
        <div class="card p-1 col-span-2">

          <div class="control-group order-processing light">
            <div class="group-header">
              <div class="group-icon">
                <!-- icon x·ª≠ l√Ω ƒë∆°n: h·ªôp + b√°nh rƒÉng -->
                <svg width="20" height="20" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor">
                <!-- h·ªôp g√≥i -->
                <g stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">
                  <path d="M10 20h44v8H10V20z" />
                  <path d="M10 28h44v14H10V28z" />
                  <path d="M20 28v-8" />
                  <path d="M44 28v-8" />
                </g>
                <!-- ƒë∆∞·ªùng trend d∆∞·ªõi h·ªôp -->
                <polyline points="12,50 20,42 28,46 36,38 44,44 52,36" fill="none" stroke="#00b8ff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="20" cy="42" r="3" fill="#a359ff" stroke="none"/>
                <circle cx="28" cy="46" r="3" fill="#00ff9d" stroke="none"/>
                <circle cx="36" cy="38" r="3" fill="#ff5370" stroke="none"/>
                <circle cx="44" cy="44" r="3" fill="#ffd54f" stroke="none"/>
                <!-- ƒë·ªìng h·ªì nh·ªè b√™n ph·∫£i tr√™n -->
                <g transform="translate(44,12)">
                  <circle cx="0" cy="0" r="8" stroke-width="2" />
                  <line x1="0" y1="0" x2="0" y2="-4" stroke-width="2" stroke-linecap="round"/>
                  <line x1="0" y1="0" x2="3" y2="0" stroke-width="2" stroke-linecap="round"/>
                </g>
              </svg>

              </div>
              <div class="group-title-wrap">
                <h2 class="group-title">B√†n giao & v·∫≠n chuy·ªÉn</h2>
                <div class="group-subtitle">T√¨nh tr·∫°ng giao h√†nh nhanh & c√°c b√™n v·∫≠n chuy·ªÉn</div>
              </div>
            </div>
        </div>

        <div class="flex gap-4 justify-center mt-2 p-1">
            <!-- HTML -->
              <div class="fast-delivery-wrapper">
                <!-- card GELE -->
                <div class="fast-card">
                  <div class="fast-header">KHO GELE</div>
                  <div class="fast-body">
                    <div class="percent-block">
                      <div class="big-pct" id="gele-fast-pct">--%</div>
                      <div class="sub-label">Giao nhanh</div>
                    </div>
                    <div class="details">
                      <div class="line">
                        <div class="label">Nhanh:</div>
                        <div class="value" id="gele-fast-count">-- ƒë∆°n</div>
                      </div>
                      <div class="line">
                        <div class="label">Ch·∫≠m:</div>
                        <div class="value" id="gele-not-fast-count">-- ƒë∆°n</div>
                      </div>
                      <div class="line small">
                        <div class="label">T·ªïng ƒë√£ giao:</div>
                        <div class="value" id="gele-total-shipped">-- ƒë∆°n</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- card TOKY -->
                <div class="fast-card">
                  <div class="fast-header">KHO TOKY</div>
                  <div class="fast-body">
                    <div class="percent-block">
                      <div class="big-pct" id="toky-fast-pct">--%</div>
                      <div class="sub-label">Giao nhanh</div>
                    </div>
                    <div class="details">
                      <div class="line">
                        <div class="label">Nhanh:</div>
                        <div class="value" id="toky-fast-count">-- ƒë∆°n</div>
                      </div>
                      <div class="line">
                        <div class="label">Ch·∫≠m:</div>
                        <div class="value" id="toky-not-fast-count">-- ƒë∆°n</div>
                      </div>
                      <div class="line small">
                        <div class="label">T·ªïng ƒë√£ giao:</div>
                        <div class="value" id="toky-total-shipped">-- ƒë∆°n</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- container -->
            <div class="carrier-grid" id="carrier-summary-container">
              <!-- JS will inject cards here -->
            </div>
            

        </div>

        
        <div class="card p-1 col-span-1">
          <div class="control-group order-processing light">
              <div class="group-header">
                <div class="group-title-wrap">
                  <h2 class="group-title">Giao ƒë√∫ng h·∫°n</h2>
                  <div class="group-subtitle">Qu·∫£n l√Ω giao ƒë√∫ng h·∫°n m√† s√†n ƒë∆∞a ra.</div>
                </div>
              </div>
          </div>
          <div class="flex gap-4 justify-start mt-2 p-1 md:flex-col md:overflow-visible" id="deadline-cards">
            <!-- card s·∫Ω ƒë∆∞·ª£c inject b·ªüi JS -->
          </div>

        </div>

        <div class="card p-1 col-span-2">
          <div class="control-group order-processing light">
              <div class="group-header">
                <div class="group-title-wrap">
                  <h2 class="group-title">ƒê∆°n l·ªói/ sai s√≥t</h2>
                  <div class="group-subtitle">T·ªâ l·ªá/ thi·ªát h·∫°i v√† ph√¢n lo·∫°i l√Ω do</div>
                </div>
              </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-5 gap-2 mt-4">
        <div class="card p-1 col-span-2">
          <div class="control-group order-processing light">
            <div class="group-header">
              <div class="group-icon">
                  <svg width="20" height="20" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor">
                    <!-- h·ªôp -->
                    <g stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">
                      <path d="M14 20h36v8H14V20z" />
                      <path d="M14 28h36v14H14V28z" />
                      <path d="M24 28v-8" />
                      <path d="M40 28v-8" />
                    </g>
                    <!-- 3 thanh ph√¢n lo·∫°i (ƒë·ªô kh√≥ kh√°c nhau) -->
                    <rect x="18" y="48" width="6" height="8" rx="1.5" fill="#00b8ff"/>
                    <rect x="30" y="44" width="6" height="12" rx="1.5" fill="#a359ff"/>
                    <rect x="42" y="52" width="6" height="4" rx="1.5" fill="#ff5370"/>
                    <!-- k·∫øt n·ªëi nh·ªè t·ª´ h·ªôp xu·ªëng c√°c thanh -->
                    <line x1="24" y1="42" x2="21" y2="48" stroke="#9ba4b4" stroke-width="1" stroke-linecap="round"/>
                    <line x1="32" y1="42" x2="33" y2="44" stroke="#9ba4b4" stroke-width="1" stroke-linecap="round"/>
                    <line x1="40" y1="42" x2="45" y2="52" stroke="#9ba4b4" stroke-width="1" stroke-linecap="round"/>
                  </svg>

              </div>
              <div class="group-title-wrap">
                <h2 class="group-title">Categories</h2>
                <div class="group-subtitle">Ph√¢n lo·∫°i s·∫£n ph·∫©m ƒë√£ g√≥i theo ƒë·ªô kh√≥</div>
              </div>
            </div>
        </div>

          <div class="flex gap-4 justify-center mt-2">
                <!-- pie chart container -->
                <div class="pie-wrapper" style="flex:1; min-width:220px; display:flex; flex-direction:column; align-items:center; position:relative;">
                  <div style="position:relative; width:220px; margin-bottom:20px">
                    <canvas id="pieCatoCanvas" width="220" height="220" style="max-width:100%;"></canvas>
                  </div>
                   <div id="legend-container" style="flex:1; display:flex; flex-direction:row; gap:10px; position:relative;    flex-wrap: wrap;">
                    <!-- labels will inject here -->
                  </div>
                </div>
          </div>
        </div>

        <div class="card p-1 col-span-3">
          <div class="control-group order-processing light">
            <div class="group-header">
              <div class="group-icon">
                <svg width="20" height="20" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor">
                    <circle cx="24" cy="20" r="8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    <path d="M16 36c0-4 4-6 8-6s8 2 8 6v4H16v-4z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    <g transform="translate(40,16)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">
                      <circle cx="0" cy="0" r="6"/>
                      <path d="M0 -10v4"/>
                      <path d="M0 10v-4"/>
                      <path d="M10 0h-4"/>
                      <path d="M-10 0h4"/>
                      <path d="M7.07 -7.07l-2.83 2.83"/>
                      <path d="M7.07 7.07l-2.83 -2.83"/>
                      <path d="M-7.07 -7.07l2.83 2.83"/>
                      <path d="M-7.07 7.07l2.83 -2.83"/>
                      <circle cx="0" cy="0" r="2"/>
                    </g>
                    <rect x="36" y="40" width="4" height="8" rx="1" fill="currentColor"/>
                    <rect x="44" y="36" width="4" height="12" rx="1" fill="currentColor"/>
                    <rect x="52" y="32" width="4" height="16" rx="1" fill="currentColor"/>
                    <path d="M36 48 L54 30" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="52,32 54,30 56,32" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>

              </div>
              <div class="group-title-wrap">
                <h2 class="group-title">Hi·ªáu su·∫•t nh√¢n s·ª±</h2>
                <div class="group-subtitle">Gi√°m s√°t hi·ªáu qu·∫£ s·ª≠ d·ª•ng nh√¢n s·ª±</div>
              </div>
            </div>
        </div>

          <div class="flex gap-4 justify-center mt-2">
              <div style="width:100%; overflow:hidden; padding:5px;">
                <table class="shared-table">
                  <thead>
                    <tr>
                      <th style="min-width:80px;">T√™n nh√¢n s·ª±</th>
                      <th>Gi·ªù l√†m</th>
                      <th>G√≥i ƒë∆∞·ª£c</th>
                      <th>Doanh s·ªë</th>
                      <th>Hi·ªáu su·∫•t</th>
                      <th>Xu h∆∞·ªõng g√≥i</th> <!-- m·ªõi -->
                    </tr>
                  </thead>
                  <tbody id="shared-body">
                    <!-- JS inject -->
                  </tbody>
                </table>
              </div>

          </div>

        </div>
      </div>

      <div class="data-grid">
        <div class="data-card">
          <div class="data-card-title">T·ªïng t·ªìn 2 kho</div>
          <div class="data-card-value gradient">${formatVND(inventory_summary.sum.amount)} ƒë</div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">S·∫£n ph·∫©m:</span>
            <span class="font-semibold">${formatNumberWithCommas(inventory_summary.sum.onhand)} pcs</span>
          </div>
        </div>
        <div class="data-card">
          <div class="data-card-title">T·ªìn kho H√Ä N·ªòI</div>
          <div class="data-card-value gradient">${formatVND(inventory_summary.gele.amount)} ƒë</div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">S·∫£n ph·∫©m:</span>
            <span class="font-semibold">${formatNumberWithCommas(inventory_summary.gele.onhand)} pcs</span>
          </div>
        </div>
        <div class="data-card">
          <div class="data-card-title">T·ªìn kho S√ÄI G√íN</div>
          <div class="data-card-value gradient">${formatVND(inventory_summary.toky.amount)} ƒë</div>
          <div class="mt-1 text-[1rem]">
            <span class="tiny">S·∫£n ph·∫©m:</span>
            <span class="font-semibold">${formatNumberWithCommas(inventory_summary.toky.onhand)} pcs</span>
          </div>
        </div>
        
      </div>

      
    `;
    // tr√¨ ho√£n ƒë·ªÉ DOM c·∫≠p nh·∫≠t r·ªìi m·ªõi l·∫•y canvas
      setTimeout(() => {
        const canvasEl = document.getElementById("packingPie");
        if (!canvasEl) return; // ph√≤ng tr√°nh
        const ctx = canvasEl.getContext("2d");

        const chartData = {
          labels: ["Ch∆∞a g√≥i", "ƒê√£ g√≥i"],
          datasets: [{
            data: [pie_data.unpacked, pie_data.packed],
            backgroundColor: ["#ff8f3f", "#3f8fff"],
            hoverOffset: 8,
            borderWidth: 0
          }]
        };
        const pieChart = new Chart(ctx, {
          type: "doughnut",
          data: chartData,
          options: {
            cutout: "70%",
            plugins: {
              tooltip: {
                enabled: true,
                callbacks: {
                  label: (ctx) => {
                    const label = ctx.label || "";
                    const val = ctx.parsed || 0;
                    const pct = label === "Ch∆∞a g√≥i" ? pie_data.unpacked_pct : pie_data.packed_pct;
                    return `${label}: ${val} ƒë∆°n (${pct}%)`;
                  }
                }
              },
              legend: { display: false }
            },
            animation: { duration: 400 }
          }
        });

        function drawConnector() {
          const meta = pieChart.getDatasetMeta(0);
          const arc = meta.data[0]; // "Ch∆∞a g√≥i"
          if (!arc) return;
          const center = arc.getCenterPoint();
          const canvas = pieChart.canvas;
          const ctx2 = canvas.getContext("2d");
          const ann = document.getElementById("annotation");
          if (!ann) return;
          const annRect = ann.getBoundingClientRect();
          const canvasRect = canvas.getBoundingClientRect();

          const startX = center.x;
          const startY = center.y;
          const targetX = annRect.left - canvasRect.left - 8;
          const targetY = annRect.top - canvasRect.top + annRect.height / 3;

          ctx2.save();
          ctx2.strokeStyle = "#888";
          ctx2.lineWidth = 2;
          ctx2.lineCap = "round";
          ctx2.beginPath();
          ctx2.moveTo(startX, startY);
          const midX = (startX + targetX) / 2;
          ctx2.quadraticCurveTo(midX, startY, targetX, targetY);
          ctx2.stroke();
          ctx2.restore();
        }

        pieChart.options.animation.onComplete = drawConnector;
        window.addEventListener("resize", () => {
          setTimeout(drawConnector, 100);
        });
        // l·∫ßn ƒë·∫ßu
        setTimeout(drawConnector, 250);
      }, 0);

       // delay gi·ªëng b·∫°n d√πng
        setTimeout(() => {
          const canvas3 = document.getElementById("pieCatoCanvas");
          if (!canvas3) return;
          const ctx3 = canvas3.getContext("2d");

          // chart
          const chartData3 = {
            labels: pie_cato.labels,
            datasets: [{
              data: pie_cato.values,
              backgroundColor: pie_cato.labels.map((_, i) => COLOR_PALETTE[i % COLOR_PALETTE.length]),
              hoverOffset: 6,
              borderWidth: 0
            }]
          };
          const pieChart3 = new Chart(ctx3, {
            type: 'doughnut',
            data: chartData3,
            options: {
              cutout: '60%',
              plugins: {
                tooltip: {
                  enabled: true,
                  callbacks: {
                    label: (ctx3) => {
                      const label = ctx3.label || '';
                      const val = ctx3.parsed || 0;
                      const pct = pie_cato.percentages[ctx.dataIndex] || 0;
                      const info = categories_summary[label] || {};
                      return `${label}: ${pct}% ‚Äî ${formatVND(info.doanhso)} / ${info.sosanpham} sp`;
                    }
                  }
                },
                legend: { display: false }
              },
              animation: { duration: 400 }
            }
          });

          // build outside labels with connectors
          function buildLabels3() {
            const container3 = document.getElementById("legend-container");
            container3.innerHTML = ""; // reset

            // sort descending doanhso
            const arr = Object.entries(categories_summary)
              .sort((a,b)=> b[1].doanhso - a[1].doanhso);

            arr.forEach(([label, info], idx) => {
              const color = COLOR_PALETTE[idx % COLOR_PALETTE.length];

              const callout = document.createElement("div");
              callout.className = "callout";
              callout.dataset.label = label;
              callout.innerHTML = `
                <div class="color-dot" style="background:${color};"></div>
                <div class="label-text">
                  <div style="display:flex; align-items:center; gap:6px;">
                    <div style="font-weight:600;">${label} <span style="color:#db182c">(${info.pct_doanhso}%)</span></div>
                    ${idx === 0 ? '<div style="background: linear-gradient(135deg,#00b8ff,#a359ff); padding:2px 6px; border-radius:999px; font-size:10px; margin-left:4px;">TOP</div>' : ''}
                  </div>
                  <div class="small">
                    <div>${formatVND(info.doanhso)}ƒë -  ${info.sosanpham} sp</div>
                  </div>
                </div>
              `;
              container3.appendChild(callout);
            });
          }

          buildLabels3();
        }, 0);


      setTimeout(() => {
    const canvas = document.getElementById("hourlyChart");
    if (!canvas) {
      console.warn("Canvas hourlyChart kh√¥ng t√¨m th·∫•y");
      return;
    }
    const ctx = canvas.getContext("2d");

    const labels = hourly.categories || [];
    const geleData = hourly.data_gele || [];
    const tokyData = hourly.data_toky || [];

    new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [
          {
            label: "HN",
            data: geleData,
            borderWidth: 2,
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointHoverRadius: 6,
            borderColor: "#7f5af0",
            backgroundColor: "#7f5af0",
            pointBackgroundColor: "#7f5af0",
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#7f5af0",
          },
          {
            label: "SG",
            data: tokyData,
            borderWidth: 2,
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointHoverRadius: 6,
            borderColor: "#00c2ff",
            backgroundColor: "#00c2ff",
            pointBackgroundColor: "#00c2ff",
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#00c2ff",
          },
        ],
      },
      options: {
        responsive: true,
        interaction: {
          mode: "index",
          intersect: false,
        },
        stacked: false,
        plugins: {
          legend: {
            display: true,
            labels: {
              boxWidth: 12,
              padding: 16,
              color: "#e2e8f0",
              font: { weight: "600" },
            },
          },
          tooltip: {
            callbacks: {
              label: (context) => {
                const label = context.dataset.label || "";
                const value = context.parsed.y;
                return `${label}: ${value} ƒë∆°n`;
              },
            },
            padding: 10,
            titleMarginBottom: 6,
          },
        },
        scales: {
          x: {
            title: {
              display: true,
              text: "Gi·ªù trong ng√†y",
              color: "#94a3b8",
              font: { size: 12, weight: "600" },
            },
            ticks: { color: "#cbd5e1" },
            grid: { display: false },
          },
          y: {
            title: {
              display: false
            },
            ticks: {
              color: "#cbd5e1",
              beginAtZero: true,
              precision: 0,
            },
            grid: {
              color: "rgba(255,255,255,0.05)",
              drawBorder: false,
            },
          },
        },
      },
    });
  }, 0);

      function formatNumber(x) {
    return new Intl.NumberFormat('vi-VN').format(x);
  }

      function buildSharedTable() {
      const tbody = document.getElementById("shared-body");
      tbody.innerHTML = "";

      // ph·∫ßn render cho TOKY (t∆∞∆°ng t·ª± GELE)
      const geleUsers = Object.entries(by_sender.gele || {});
      if (geleUsers.length) {
        const sep2 = document.createElement("tr");
        sep2.className = "row-separator";
        sep2.innerHTML = `
          <td colspan="8">Kho H√† N·ªôi</td>
        `;
        tbody.appendChild(sep2);
        geleUsers.forEach(([name, info]) => {
          const tr = document.createElement("tr");
          tr.className = "sender-row warehouse-gele";

          // t√≠nh top 3 xu h∆∞·ªõng g√≥i theo s·ªë l∆∞·ª£ng
          const totalQty = info.total_quantity || 1; // ph√≤ng tr√°nh chia 0
          const catoEntries = Object.entries(info.cato || {});
          const top3 = catoEntries
            .sort((a, b) => b[1] - a[1]) // gi·∫£m d·∫ßn theo count
            .slice(0, 3);

          // build trend HTML
          const trendHtml = top3
            .map(([cat, count], idx) => {
              const pct = ((count / totalQty) * 100).toFixed(0);
              const safeName = cat || "Kh√¥ng r√µ";
              return `
                <div class="trend-pill ${idx === 0 ? "top1" : ""}">
                  <div class="cat-name">${safeName}</div>
                  <div class="pct">${pct}%</div>
                </div>
              `;
            })
            .join("");

          tr.innerHTML = `
            <td>${name}</td>
            <td class="numeric">${info.work_hours}</td>
            <td class="numeric">${info.total_order}</td>
            <td class="numeric">${formatNumber(info.total_money)}</td>
            <td class="numeric">${formatNumber(info.money_per_hour)} /h</td>
            <td>
              <div class="trend-badges">
                ${trendHtml}
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });}

      // ph·∫ßn render cho TOKY (t∆∞∆°ng t·ª± GELE)
      const tokyUsers = Object.entries(by_sender.toky || {});
      if (tokyUsers.length) {
        const sep2 = document.createElement("tr");
        sep2.className = "row-separator";
        sep2.innerHTML = `
          <td colspan="8">Kho S√†i G√≤n</td>
        `;
        tbody.appendChild(sep2);
        tokyUsers.forEach(([name, info]) => {
          const tr = document.createElement("tr");
          tr.className = "sender-row warehouse-toky";

          // t√≠nh top 3 xu h∆∞·ªõng g√≥i theo s·ªë l∆∞·ª£ng
          const totalQty = info.total_quantity || 1; // ph√≤ng tr√°nh chia 0
          const catoEntries = Object.entries(info.cato || {});
          const top3 = catoEntries
            .sort((a, b) => b[1] - a[1]) // gi·∫£m d·∫ßn theo count
            .slice(0, 3);

          // build trend HTML
          const trendHtml = top3
            .map(([cat, count], idx) => {
              const pct = ((count / totalQty) * 100).toFixed(0);
              const safeName = cat || "Kh√¥ng r√µ";
              return `
                <div class="trend-pill ${idx === 0 ? "top1" : ""}">
                  <div class="cat-name">${safeName}</div>
                  <div class="pct">${pct}%</div>
                </div>
              `;
            })
            .join("");

          tr.innerHTML = `
            <td>${name}</td>
            <td class="numeric">${info.work_hours}</td>
            <td class="numeric">${info.total_order}</td>
            <td class="numeric">${formatNumber(info.total_money)}</td>
            <td class="numeric">${formatNumber(info.money_per_hour)} /gi·ªù</td>
            <td>
              <div class="trend-badges">
                ${trendHtml}
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });}
    }

    // init
    buildSharedTable();


    function formatNumber(v) {
    return new Intl.NumberFormat('vi-VN').format(v);
      }

      // render the "sum" section
      function renderCarrierSummary() {
        const container = document.getElementById("carrier-summary-container");
        container.innerHTML = "";
        const sum = carrier_summary.sum || {};
        // sort by total descending
        const entries = Object.entries(sum).sort((a,b)=> b[1].total - a[1].total);
        entries.forEach(([carrier, stats]) => {
          const card = document.createElement("div");
          card.className = "carrier-card";
          card.innerHTML = `
            <div class="carrier-name">
              <div>${carrier}</div>
              <div class="percent-badge">${stats.rate}%</div>
            </div>
            <div class="stats">
              <div class="stat-line">
                <div class="stat-label">GIAO / G√ìI: </div><div class="stat-value">${formatNumber(stats.handed_over)} / ${formatNumber(stats.packed)}</div>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      renderCarrierSummary();

      function fillCard(scope, prefix) {
        const data = fast_delivery[scope] || {};
        const total = (data.fast || 0) + (data.not_fast || 0);
        document.getElementById(`${prefix}-fast-pct`).textContent = data.fast_pct != null ? `${data.fast_pct}%` : "--%";
        document.getElementById(`${prefix}-fast-count`).textContent = `${data.fast} ƒë∆°n`;
        document.getElementById(`${prefix}-not-fast-count`).textContent = `${data.not_fast} ƒë∆°n`;
        document.getElementById(`${prefix}-total-shipped`).textContent = `${total} ƒë∆°n`;
      }
      fillCard("gele", "gele");
      fillCard("toky", "toky");

      // t·∫°o card DOM t·ª´ template d·ªØ li·ªáu
      function makeCard(statKey, data) {
        const cfg = STATUS_CONFIG.find(c => c.key === statKey);
        if (!cfg) return null;

        const count = data[statKey] || 0;
        const pct = (data[statKey + '_pct'] !== undefined) ? data[statKey + '_pct'] : 0;

        const wrapper = document.createElement('div');
        wrapper.innerHTML = `
        <div class="deadline-card flex-shrink-0 min-w-[140px] bg-[#202633] p-4 rounded-xl relative overflow-hidden group hover:shadow-[0_20px_40px_rgba(163,89,255,0.3)] transition-all duration-300">
  <div class="flex items-center justify-between mb-2">
    <div class="text-xs font-medium uppercase tracking-wide text-[#c0bfe0]">${cfg.title}</div>
    <div class="text-sm font-semibold">${cfg.icon}</div>
  </div>
  <div class="text-[2.4rem] font-bold leading-none" style="line-height:1;">
    ${pct}% 
  </div>
  <div class="mt-1 text-sm text-[#9ba4b4]">
    <span class="font-medium">${count.toLocaleString()} ƒë∆°n</span>
  </div>
  <div class="absolute -top-1 -right-1 w-20 h-20 rounded-full bg-gradient-to-tr ${cfg.colorClass}/30 to-transparent blur-2xl pointer-events-none"></div>
</div>
        `;
        return wrapper;
      }
      function loadDeadlineSummary() {
        try {
          const container = document.getElementById('deadline-cards');
          container.innerHTML = ''; // d·ªçn s·∫°ch

          // th·ª© t·ª± hi·ªÉn th·ªã: not_shipped_late, shipped_late, shipped_on_time
          ['not_shipped_late', 'shipped_late', 'shipped_on_time'].forEach(key => {
            const card = makeCard(key, deadline_summary.sum);
            if (card) container.appendChild(card);
          });
        } catch (e) {
          console.error('Load deadline summary failed', e);
          const container = document.getElementById('deadline-cards');
          container.innerHTML = `<div class="col-span-3 text-red-400 text-sm">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu: ${e.message}</div>`;
        }
      }
      loadDeadlineSummary();

  }

  

</script>
<script type="text/javascript">
  // override xemBaoCao ƒë·ªÉ ƒë·∫£m b·∫£o g·ªçi ƒë√∫ng
async function xemBaoCao() {
  const start = document.getElementById("start_date").value;
  const end = document.getElementById("end_date").value;
  const content = document.getElementById("report-content");

  if (!start || !end) {
    alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß ng√†y b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c.");
    return;
  }

  const location_ids = window.regionIDs[currentRegionIndex];
  const regionName = window.regionNames[currentRegionIndex];
  const sumUrl = `/quantri/api_kho_sumreport?location_ids=${location_ids}&start_date=${start}&end_date=${end}`;
  const noteUrl = `/quantri/api_kho_getnotereport?start_date=${start}&end_date=${end}`;

  content.innerHTML = `<p class="text-slate-300">üîÑ ƒêang t·∫£i b√°o c√°o...</p>`;

  // reset container
  let ui = document.getElementById("report-ui");
  if (!ui) {
    ui = document.createElement("div");
    ui.id = "report-ui";
    content.appendChild(ui);
  }
  ui.innerHTML = "";

  // containers for note report
  let noteContainer = document.getElementById("note-report");
  if (!noteContainer) {
    noteContainer = document.createElement("div");
    noteContainer.id = "note-report";
    noteContainer.style.display = "flex";
    noteContainer.style.gap = "12px";
    noteContainer.style.flexWrap = "wrap";
    noteContainer.style.marginTop = "16px";
    ui.appendChild(noteContainer);
  } else {
    noteContainer.innerHTML = "";
  }

  try {
    // fetch both in parallel
    const [sumResp, noteResp] = await Promise.all([
      fetch(sumUrl),
      fetch(noteUrl)
    ]);

    if (!sumResp.ok) throw new Error("‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu b√°o c√°o t·ªïng.");
    if (!noteResp.ok) throw new Error("‚ùå Kh√¥ng th·ªÉ t·∫£i ph·∫£n h·ªìi.");

    const sumData = await sumResp.json();
    const notes = await noteResp.json();

    content.innerHTML = `
      <p class="text-slate-300">
        üìÖ B√°o c√°o t·ª´ <strong>${start}</strong> ƒë·∫øn <strong>${end}</strong> cho khu v·ª±c <strong>${regionName}</strong>.
      </p>
    `;

    renderReportInline(sumData, start, end, regionName);

    // render note-report
    if (!Array.isArray(notes) || notes.length === 0) {
      const empty = document.createElement("div");
      empty.className = "fast-card";
      empty.style.flex = "1 1 100%";
      empty.innerHTML = `<div class="fast-header">Kh√¥ng c√≥ ph·∫£n h·ªìi trong kho·∫£ng n√†y</div>`;
      noteContainer.appendChild(empty);
    } else {
      notes.forEach(n => {
        const card = document.createElement("div");
        card.className = "fast-card";
        card.style.maxWidth = "300px";
        card.style.flex = "1 1 300px";
        card.classList.add("max-w-full");
        const locationLabel = n.location === "gele" ? "Kho H√† N·ªôi" :
                      n.location === "toky" ? "Kho S√†i G√≤n" :
                      escapeHtml(n.location || "-");

        card.innerHTML = `
          <div style="
              font-size:1.4rem;
              font-weight:700;
              padding:10px 14px;
              border-radius:8px;
              color:#fff;
              margin-bottom:6px;
              display:inline-block;
              background: ${
                n.location === "gele"
                  ? "linear-gradient(135deg,var(--accent-purple), var(--accent-blue))"
                  : n.location === "toky"
                    ? "linear-gradient(135deg,#ff9f43,#ffe066)"
                    : "#1f2235"
              };
          ">
            ${locationLabel}

          </div>

          <div class="fast-body" style="display:flex;flex-direction:column;gap:8px;">
            <div style="display:flex;gap:8px;flex-wrap:wrap;width:100%">
              <div style="font-size:.8rem;color:rgba(155,164,180,1);text-transform:uppercase;font-weight:600;">Tags:</div>
              <div style="display:flex;gap:6px;flex-wrap:wrap;">
                ${ (Array.isArray(n.tags) ? n.tags : []).map(tag => `
                  <div class="trend-pill" style="padding:.35rem .8rem;font-size:.85rem; background: linear-gradient(135deg,var(--accent-blue),var(--accent-purple)); color:#fff; font-weight:600; border-radius:999px;">
                    ${escapeHtml(tag)}
                  </div>`).join('') }
              </div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;;width:100%">
              <div style="font-size:.6rem;color:rgba(155,164,180,1);text-transform:uppercase;font-weight:600;">Th·ªùi gian:</div>
              <div style="font-weight:600;">${formatTimeHourDay(n.timestamp)}</div>
            </div>
            <div style="margin-top:4px; padding:5px; font-size:1.15rem; line-height:1.3; width:100%;">
            <div style="
                background: rgba(255,255,255,0.03);
                padding:10px;
                border:1px solid rgba(127,90,240,0.3);
                border-radius:8px;
                text-align: left;
                ">
              ${escapeAndPreserve(n.content || "")}
            </div>
          </div>

          </div>
        `;
        noteContainer.appendChild(card);
      });
    }

  } catch (error) {
    content.innerHTML = `<p class="text-red-400">‚ùå L·ªói: ${error.message}</p>`;
    console.error(error);
    const errCard = document.createElement("div");
    errCard.className = "fast-card";
    errCard.style.flex = "1 1 100%";
    errCard.innerHTML = `<div class="fast-header">L·ªói t·∫£i ph·∫£n h·ªìi ho·∫∑c b√°o c√°o</div><div style="padding-top:6px;color:#ff5370;font-size:.85rem;">${escapeHtml(error.message)}</div>`;
    noteContainer.appendChild(errCard);
  }

  
}

// helpers (if not already present)
function escapeHtml(str) {
  if (!str) return "";
  return str.replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#39;");
}
function escapeAndPreserve(str) {
if (!str) return "";
  const escaped = str
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#39;");
  return escaped.replace(/\r?\n/g, "<br>");
}


function formatTimeHourDay(iso) {
  if (!iso) return "-";
  try {
    let s = iso;
    if (s.endsWith("Z")) s = s.slice(0, -1);
    if (s.includes("+")) s = s.split("+")[0];
    const d = new Date(s);
    const pad = v => String(v).padStart(2, "0");
    // gi·ªù:ph√∫t - ng√†y/th√°ng/nƒÉm
    return `${pad(d.getHours())}:${pad(d.getMinutes())} - ${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
  } catch {
    return iso;
  }
}



</script>

<script type="text/javascript">
  window.addEventListener("DOMContentLoaded", () => {
    const d = new Date();
    const pad = (n) => n.toString().padStart(2, '0');
    const today = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
    document.getElementById("start_date").value = today;
    document.getElementById("end_date").value = today;
  });
</script>


<script>
  // tag selection toggle
  document.querySelectorAll('#feedback-tags .trend-pill').forEach(el => {
    el.addEventListener('click', () => {
      el.classList.toggle('active');
      if (el.classList.contains('active')) {
        el.style.background = 'linear-gradient(135deg,var(--accent-blue),var(--accent-purple))';
        el.style.color = '#fff';
      } else {
        el.style.background = 'rgba(255,255,255,0.04)';
        el.style.color = '#e5e9ff';
      }
    });
  });

  // show/hide panel
  document.getElementById('add-feedback-btn').addEventListener('click', () => {
    const p = document.getElementById('feedback-panel');
    p.style.display = p.style.display === 'none' ? 'block' : 'none';
  });
  document.getElementById('feedback-cancel').addEventListener('click', () => {
    document.getElementById('feedback-panel').style.display = 'none';
  });

  // submit
  document.getElementById('feedback-submit').addEventListener('click', async () => {
    const location = document.getElementById('feedback-location').value;
    const content = document.getElementById('feedback-content').value.trim();
    const selectedTags = Array.from(document.querySelectorAll('#feedback-tags .trend-pill.active'))
      .map(el => el.dataset.tag);
    const msgEl = document.getElementById('feedback-msg');
    msgEl.textContent = '';
    if (!content) {
      msgEl.style.color = '#ffb86c';
      msgEl.textContent = 'Vui l√≤ng nh·∫≠p n·ªôi dung ph·∫£n h·ªìi.'; 
      return;
    }
    if (selectedTags.length === 0) {
      msgEl.style.color = '#ffb86c';
      msgEl.textContent = 'Ch·ªçn √≠t nh·∫•t m·ªôt tag.'; 
      return;
    }

    const payload = {
      location: location,
      tags: selectedTags,
      content: content,
      timestamp: new Date().toISOString()
    };

    try {
      document.getElementById('feedback-submit').disabled = true;
      const res = await fetch('/quantri/api_kho_newnotereport', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Network error');
      msgEl.style.color = '#00ff9d';
      msgEl.textContent = 'G·ª≠i ph·∫£n h·ªìi th√†nh c√¥ng.'; 
      // reset
      document.getElementById('feedback-content').value = '';
      document.querySelectorAll('#feedback-tags .trend-pill.active').forEach(el => {
        el.classList.remove('active');
        el.style.background = 'rgba(255,255,255,0.04)';
        el.style.color = '#e5e9ff';
      });
      setTimeout(() => {
        document.getElementById('feedback-panel').style.display = 'none';
        msgEl.textContent = '';
      }, 1200);
    } catch (e) {
      msgEl.style.color = '#ff5370';
      msgEl.textContent = 'G·ª≠i th·∫•t b·∫°i, th·ª≠ l·∫°i.'; 
    } finally {
      document.getElementById('feedback-submit').disabled = false;
    }
  });
</script>

<script>
window.addEventListener("DOMContentLoaded", async () => {
  const container = document.getElementById("shopee-report");
  if (!container) return;

  try {
    const res = await fetch("/quantri/api_kho_getshopeereport");
    if (!res.ok) throw new Error(res.statusText);
    const data = await res.json();

    // Ch·ªâ quan t√¢m 3 key n√†y
    const keys = ["sd", "nfr", "lsr"];
    // B·∫£n ƒë·ªì t√™n hi·ªÉn th·ªã
    const labelMap = {
      sd:  "Fast Handover Rate",
      nfr: "ƒê∆°n Kh√¥ng Th√†nh C√¥ng",
      lsr: "L·ªá Giao H√†ng Tr·ªÖ"
    };

    Object.entries(data).forEach(([shopKey, shopData]) => {
      const card = document.createElement("div");
      card.className = "bg-[var(--bg-panel)] rounded-2xl p-6 shadow-md";

      // Ti√™u ƒë·ªÅ shop
      const title = document.createElement("h2");
      title.className = "text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-[var(--accent-purple)] to-[var(--accent-blue)]";
      title.textContent = shopKey.replace(/_/g, " ");
      card.appendChild(title);

      // ƒêi·ªÉm ph·∫°t
      const pts = shopData.ongoing_points.totalPoints;
      const ptsDiv = document.createElement("div");
      ptsDiv.className = "mt-3 flex items-center gap-2 text-lg font-semibold text-[var(--accent-red)]";
      ptsDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 2a8 8 0 108 8 8 8 0 00-8-8zm0 12a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm.25-4.75h-.5a.75.75 0 010-1.5h.5a.75.75 0 010 1.5z"/>
        </svg>
        <span>ƒêi·ªÉm ph·∫°t: ${pts}</span>
      `;
      card.appendChild(ptsDiv);

      // 3 ch·ªâ s·ªë tr√™n 1 h√†ng
      const metrics = shopData.shop_performance;
      const row = document.createElement("div");
      row.className = "mt-4 flex justify-between gap-4";

      keys.forEach(key => {
        const m = metrics.find(item => item.metric_key === key);
        if (!m) return;

        // format value
        let v = (key === "sd" || key === "crr" || key === "nfr" || key === "lsr")
          ? m.metric_value
          : m.metric_value;

        const isBad = Number(m.status) === 1;

        const box = document.createElement("div");
        box.className = "flex-1 bg-[rgba(255,255,255,0.05)] rounded-lg p-3 backdrop-blur-md text-center";
        box.innerHTML = `
          <div class="text-sm text-[var(--text-secondary)]">${labelMap[key]}</div>
          <div class="mt-1 text-xl font-semibold text-[var(--text-primary)]">
            ${v}
            ${isBad
              ? `<svg xmlns="http://www.w3.org/2000/svg"
     class="inline w-4 h-4 text-yellow-400"
     fill="currentColor"
     viewBox="0 0 20 20"
     aria-hidden="true">
  <path fill-rule="evenodd"
        d="M8.257 3.099c.765-1.36 2.72-1.36 3.485 0l6.518 11.588c.75 1.334-.213 2.988-1.742 2.988H3.48c-1.529 0-2.492-1.654-1.742-2.988L8.257 3.1zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a.75.75 0 00-.75.75v4.5a.75.75 0 001.5 0v-4.5A.75.75 0 0010 5z"
        clip-rule="evenodd" />
</svg>
`
              : ""}
          </div>
        `;
        row.appendChild(box);
      });

      card.appendChild(row);
      container.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    container.innerHTML = `<div class="text-red-400 text-center py-6">L·ªói t·∫£i b√°o c√°o.</div>`;
  }
});
</script>
</div>


</body></html>